<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="indi.dwq.orderingSys.data.dao.MessageMapper">

    <resultMap id="BaseResultMap" type="indi.dwq.orderingSys.data.pojo.Message">
        <!--  <association  column="user_id"   property="userName"   select="indi.dwq.orderingSys.data.dao.MessageMapper.aaaaa"
                       javaType="string" ></association>-->
        <result column="send_time" jdbcType="TIMESTAMP" property="time"/>
        <result column="content" jdbcType="VARCHAR" property="content"/>
        <association column="user_id" property="userName" javaType="string"
                     select="aaaaa"/>

    </resultMap>

    <sql id="Base_Column_List">
     user_id, send_time, content
  </sql>
    <select id="aaaaa" resultType="string">SELECT username	FROM USER WHERE id = #{user_id}</select>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from chat_record
        where id = #{id,jdbcType=INTEGER}
    </select>
    <select id="selectToday" parameterType="java.lang.Integer" resultMap="BaseResultMap">
       SELECT * FROM chat_record WHERE send_time > DATE_SUB(NOW(),INTERVAL 1 DAY) ORDER BY send_time
  </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from chat_record
    where id = #{id,jdbcType=INTEGER}
  </delete>
    <insert id="insert" parameterType="indi.dwq.orderingSys.data.pojo.Message">
    INSERT INTO chat_record ( user_id, send_time,content)
    VALUES ( (SELECT id FROM USER WHERE username = #{userName}) , #{time},#{content})
  </insert>


</mapper>